<head>
    <meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<style>
    body{
        padding: 20px;
    }
</style>
<body>
<h2>Upbit - Kraken Kimp</h2>
<div class="root">Loading..</div>
<script>
    async function getKimp() {

        function calKimp(upbit, kraken) {
            return (Math.floor(((upbit - kraken * eRate) * 100 / upbit) * 10) / 10) + '%'
        }

        const eRate = await fetch('https://quotation-api-cdn.dunamu.com/v1/forex/recent?codes=FRX.KRWUSD').then(res => res.json()).then(res => res[0].basePrice)

        const kBtc = await fetch('https://api.kraken.com/0/public/Ticker?pair=XBTUSD').then(res => res.json()).then(res => res['result']['XXBTZUSD']['c'][0]).then(Number)
        const uBtc = await fetch('https://api.upbit.com/v1/candles/days?market=KRW-BTC&count=1').then(res => res.json()).then(res => res[0]['trade_price'])
        const kimpBtc = calKimp(uBtc, kBtc)

        const kTrx = await fetch('https://api.kraken.com/0/public/Ticker?pair=TRXUSD').then(res => res.json()).then(res => res['result']['TRXUSD']['c'][0]).then(Number)
        const uTrx = await fetch('https://api.upbit.com/v1/candles/days?market=KRW-TRX&count=1').then(res => res.json()).then(res => res[0]['trade_price'])
        const kimpTrx = calKimp(uTrx, kTrx)

        const kEos = await fetch('https://api.kraken.com/0/public/Ticker?pair=EOSUSD').then(res => res.json()).then(res => res['result']['EOSUSD']['c'][0]).then(Number)
        const uEos = await fetch('https://api.upbit.com/v1/candles/days?market=KRW-EOS&count=1').then(res => res.json()).then(res => res[0]['trade_price'])
        const kimpEos = calKimp(uEos, kEos)

        // const kBtc = await fetch('https://api.kraken.com/0/public/Ticker?pair=XBTUSD').then(res => res.json()).then(res => res['result']['XXBTZUSD']['c'][0]).then(Number)
        // const uBtc = await fetch('https://api.upbit.com/v1/candles/days?market=KRW-BTC&count=1').then(res => res.json()).then(res => res[0]['trade_price'])
        // const kimpBTC = (Math.floor(((uBtc - kBtc * eRate) * 100 / uBtc) * 10) / 10) + '%'

        console.log({eRate, kBtc, uBtc, kTrx, uTrx, kEos, uEos, kimpBtc, kimpTrx, kimpEos})

        document.querySelector('.root').innerHTML = `
            - ${String(new Date).substr(0,24)}
            </br/>
            - Exchange rate: ${eRate.toLocaleString()}
            </br/>
            </br/>
            -- UPBIT --<br/>
            btc: ${uBtc.toLocaleString()}<br/>
            trx: ${uTrx}<br/>
            eos: ${uEos}<br/>
            <br/>
            -- KRAKEN --<br/>
            btc: ${kBtc.toLocaleString()}<br/>
            trx: ${kTrx}<br/>
            eos: ${kEos}<br/>
            <br/>
            -- Kimp --<br/>
            btc: ${kimpBtc}
            <br/>
            trx: ${kimpTrx}
            <br/>
            eos: ${kimpEos}
        `
    }


    getKimp()
    setInterval(() => getKimp(), 5000)
</script>
</body>
